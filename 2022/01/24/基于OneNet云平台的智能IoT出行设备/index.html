<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Carbda">
    
    <title>
        
            基于OneNet云平台的智能IoT出行设备 |
        
        Carbda
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/avatar_icon.png">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"carbda.github.io","root":"/","language":"en"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar_1.jpg","favicon":"/images/avatar_icon.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Welcome to Carbda's Blog."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/avatar_2.png">
                </a>
            
            <a class="logo-title" href="/">
                Carbda
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">基于OneNet云平台的智能IoT出行设备</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar_1.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Carbda</span>
                        
                            <span class="author-label">Lv2</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-01-24 16:44:53</span>
        <span class="mobile">2022-01-24 16:44</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Java/">Java</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/Java/Android/">Android</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Java/">Java</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="功能设计"><a href="#功能设计" class="headerlink" title="功能设计"></a>功能设计</h1><h2 id="开箱检测与智能监测"><a href="#开箱检测与智能监测" class="headerlink" title="开箱检测与智能监测"></a>开箱检测与智能监测</h2><h3 id="开箱提醒与开箱记录"><a href="#开箱提醒与开箱记录" class="headerlink" title="开箱提醒与开箱记录"></a>开箱提醒与开箱记录</h3><p>每一次打开箱子，都会被记录，用户可以通过配套的APP知道自己的箱子什么时候被打开或关闭过，同时也可以得知当前箱子的开闭状态。另外可以通过简单设置，当箱子被打开时，配套的APP发送通知给用户。<br>手机端弹框界面：<br><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.2xganh9ffuc0.webp" alt="image"><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.5iituf7e6fo0.webp" alt="image"></p>
<h3 id="环境较暗自动补光"><a href="#环境较暗自动补光" class="headerlink" title="环境较暗自动补光"></a>环境较暗自动补光</h3><p>当箱子处于打开状态，如果周围环境较暗，箱子的内置照明灯会亮起并照亮箱子内部。即使用户不得不在户外低照明的情况下开箱子，也不用一手提着手电一手找物品。另外，用户也可以手动打开照明灯进行照明。</p>
<h3 id="开箱自动拍照记录开箱人与取放物品"><a href="#开箱自动拍照记录开箱人与取放物品" class="headerlink" title="开箱自动拍照记录开箱人与取放物品"></a>开箱自动拍照记录开箱人与取放物品</h3><p>开启箱子后，摄像头会自动开启并录像，拍摄的画面最终可以在APP中查看。通过把摄像头放置在合适的位置，使得正常开箱后能捕获到人脸。这样，用户不仅可以知道开箱时间，还能知道开箱人的脸部信息，以及取出了什么物品。<br>手机端界面：<br><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.415lksnngfg0.webp" alt="image"></p>
<h2 id="旅行箱状态检测与分析"><a href="#旅行箱状态检测与分析" class="headerlink" title="旅行箱状态检测与分析"></a>旅行箱状态检测与分析</h2><h3 id="温湿度检测"><a href="#温湿度检测" class="headerlink" title="温湿度检测"></a>温湿度检测</h3><p>系统能够把箱子的温湿度数据实时发送到用户APP上。如果用户在箱子中放置了如甜品，特殊药品等对温度湿度敏感的物品，则希望旅行箱可以提供相应信息，以便在条件不合适的时候采取其他办法。<br>用户可以自主设置温湿度阈值，app也会提供推荐阈值。当箱子内环境超出阈值时可以通过app提醒用户。在现实生活中，部分用户可能会把正常充电的设备放置在密封的旅行箱内导致旅行箱温度异常升高。APP针对这种情况设置异常阈值。提醒用户检查箱内安全。<br>手机端界面与警告弹框：</p>
<table>
    <tr>
            <th>手机端界面</th>
            <th>警告弹框</th>
    </tr>
    <tr>
        <td><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.4k6bg7mtx8k0.webp" /></td>
        <td><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.7l3udrsz9840.webp" /></td>
    </tr>
</table>

<h3 id="箱子放置形状检测"><a href="#箱子放置形状检测" class="headerlink" title="箱子放置形状检测"></a>箱子放置形状检测</h3><p>系统能够把箱子的放置形状数据实时送到用户APP。正常情况下，放置形状几乎是不变的，但如果有人有意或者无意的摆动我们的箱子，APP会作出相应提醒。比如有人把我们的箱子撞翻了，或者有人挪动我们的箱子，用户都可以知道。考虑到有些物品是不能剧烈抖动的，用户还可以实时查看箱子的放置状态检测箱子是否发生倒立、侧翻、抖动等。<br>手机端界面：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.6kmc11tt96w0.webp" alt="image"></p>
<h2 id="位置与安全"><a href="#位置与安全" class="headerlink" title="位置与安全"></a>位置与安全</h2><h3 id="定位服务与导航"><a href="#定位服务与导航" class="headerlink" title="定位服务与导航"></a>定位服务与导航</h3><p>用户可以通过APP了解用户当前位置和箱子的实时位置。即使意外丢失或者被盗，也能提高找回的可能性，定位误差小于50m。<br>在APP上，亦可根据导航提供的较为快捷的路线，较短时间内寻找到箱子。<br>手机端界面：<br><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.2korin8rmrc0.webp" alt="image"></p>
<h3 id="箱子远离提醒"><a href="#箱子远离提醒" class="headerlink" title="箱子远离提醒"></a>箱子远离提醒</h3><p>用户可以通过APP开启报警功能。当箱子离开用户可视范围时，箱子通过蜂鸣器警报，APP也会提醒用户。<br>手机端弹框界面：（远离时显示异常，再次靠近时显示正常）<br><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.70mu9si5afk0.webp" alt="image"><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.758k0brnkog0.webp" alt="image"></p>
<h3 id="声音寻箱"><a href="#声音寻箱" class="headerlink" title="声音寻箱"></a>声音寻箱</h3><p>用户可以在手机上打开箱子的蜂鸣器。利用声音，用户可以快速定位箱子的位置。应用场景有：机场托运取行李，大巴行李仓取箱子，一时间找不到行李箱等。</p>
<h3 id="消息显示"><a href="#消息显示" class="headerlink" title="消息显示"></a>消息显示</h3><p>用户可以通过APP向箱子发送文字信息。在箱子意外落下时，可以把联系方式等推送到箱子外的显示屏上。如果有人发现，能够联系到主人。<br>手机端设置界面：（便于用户异步控制箱子）<br><img src="https://cdn.jsdelivr.net/gh/Carbda/image@master/image.4xciqu7bx7u0.webp" alt="image"></p>
<h1 id="APP端实现"><a href="#APP端实现" class="headerlink" title="APP端实现"></a>APP端实现</h1><p>项目中负责的部分是Android端的APP开发，开发的主要逻辑是从OneNet云平台获取数据在手机端进行处理和展示，或是从手机端的APP进行命令的下达，通过OneNet平台的命令下发到旅行箱上的万耦开发板，以此实现对于开发板一端的控制。</p>
<h2 id="OnetNET平台交互"><a href="#OnetNET平台交互" class="headerlink" title="OnetNET平台交互"></a>OnetNET平台交互</h2><h3 id="向OneNet查询设备信息"><a href="#向OneNet查询设备信息" class="headerlink" title="向OneNet查询设备信息"></a>向OneNet查询设备信息</h3><p>以查询设备信息为例，代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 向OneNet查询设备信息</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> apiKey</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> deviceId:设备ID</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDevice</span><span class="params">(String deviceId,String apiKey)</span> &#123;</span><br><span class="line">    String result=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://api.heclouds.com/devices/&quot;</span>+deviceId;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">realUrl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        <span class="comment">//打开和URL之间的连接</span></span><br><span class="line">        HttpURLConnection connection=(HttpURLConnection)realUrl.openConnection();</span><br><span class="line">        <span class="comment">//设置通用的请求属性</span></span><br><span class="line">        connection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">        connection.setRequestProperty(<span class="string">&quot;Authorization&quot;</span>,apiKey);</span><br><span class="line">        <span class="comment">//建立实际的连接</span></span><br><span class="line">        connection.connect();</span><br><span class="line">        <span class="comment">// 定义 BufferedReader输入流来读取URL的响应</span></span><br><span class="line">        in = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(</span><br><span class="line">                connection.getInputStream()));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = in.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            result += line;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;查询设备信息出现异常！ &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用finally块来关闭输入流</span></span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="literal">null</span>) &#123;</span><br><span class="line">                in.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;IO close error !&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查找设备数据点"><a href="#查找设备数据点" class="headerlink" title="查找设备数据点"></a>查找设备数据点</h3><p>这部分是APP端做开发板端数据展示的基础，例如要更新APP首页的温度等信息时要调用到refresh_tempreture()，而该方法中对于数据点的查询用到的就是下面的这个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 查询设备数据点</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> deviceId:设备ID</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> apiKey</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> datastreamId:数据流id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> start:提取数据点的开始时间</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> limit:限定本次请求最多返回的数据点数，默认为100</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDataPoints</span><span class="params">(String deviceId,String apiKey,String datastreamId,String start,<span class="type">int</span> limit)</span> &#123;</span><br><span class="line">    String result=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://api.heclouds.com/devices/&quot;</span>+deviceId+<span class="string">&quot;/datapoints?datastream_id=&quot;</span>+datastreamId+<span class="string">&quot;&amp;limit=&quot;</span>+limit;<span class="comment">//&quot;&amp;start=&quot;+start</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">realUrl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        <span class="comment">//打开和URL之间的连接</span></span><br><span class="line">        HttpURLConnection connection=(HttpURLConnection)realUrl.openConnection();</span><br><span class="line">        <span class="comment">//设置通用的请求属性</span></span><br><span class="line">        connection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">        connection.setRequestProperty(<span class="string">&quot;Authorization&quot;</span>,apiKey);</span><br><span class="line">        <span class="comment">//建立实际的连接</span></span><br><span class="line">        connection.connect();</span><br><span class="line">        <span class="comment">// 定义 BufferedReader输入流来读取URL的响应</span></span><br><span class="line">        in = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(</span><br><span class="line">                connection.getInputStream()));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = in.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            result += line;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;获取数据流出现异常！ &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用finally块来关闭输入流</span></span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="literal">null</span>) &#123;</span><br><span class="line">                in.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;IO close error !&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="命令下达"><a href="#命令下达" class="headerlink" title="命令下达"></a>命令下达</h3><p>命令下达的部分主要是对于开发板的灯、蜂鸣器、显示屏上文字的展示等部分通过命令下达以进行控制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 下发命令</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> deviceId:设备ID</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> apiKey:token</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> timeout:响应最长等待时间</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> body:当报头为1时的命令命令内容，用不到时默认为&quot;&quot;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> flag:标识符，与报头一致</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> en:1打开，0关闭 ,用不到时默认为1</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">postCommand</span><span class="params">(String deviceId,String apiKey,<span class="type">int</span> timeout,String body,<span class="type">int</span> flag,<span class="type">int</span> en)</span></span><br><span class="line">&#123;</span><br><span class="line">    String result=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">    DataOutputStream out=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://api.heclouds.com/v1/synccmds?device_id=&quot;</span>+deviceId+<span class="string">&quot;&amp;timeout=&quot;</span>+timeout;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">realUrl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        <span class="comment">//打开和URL之间的连接</span></span><br><span class="line">        HttpURLConnection connection=(HttpURLConnection)realUrl.openConnection();</span><br><span class="line">        <span class="comment">//设置通用的请求属性</span></span><br><span class="line">        connection.setRequestMethod(<span class="string">&quot;POST&quot;</span>);</span><br><span class="line">        connection.setRequestProperty(<span class="string">&quot;Authorization&quot;</span>,apiKey);</span><br><span class="line">        connection.setDoInput(<span class="literal">true</span>);</span><br><span class="line">        connection.setDoOutput(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//建立实际的连接</span></span><br><span class="line">        connection.connect();</span><br><span class="line">        <span class="comment">//下发命令</span></span><br><span class="line">        out=<span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(connection.getOutputStream());</span><br><span class="line">        <span class="keyword">switch</span> (flag)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">//10行每行20个字符，目前只实现了一页</span></span><br><span class="line">                <span class="comment">//以“字节数组”形式发送给服务器信息、</span></span><br><span class="line">                <span class="type">byte</span>[] data=body.getBytes();</span><br><span class="line">                out.writeByte(<span class="number">1</span>);<span class="comment">//报头</span></span><br><span class="line">                out.writeByte(<span class="number">1</span>);<span class="comment">//当前页数</span></span><br><span class="line">                out.writeByte(<span class="number">1</span>);<span class="comment">//总页数</span></span><br><span class="line">                out.write(data);</span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                out.writeByte(<span class="number">2</span>);<span class="comment">//报头</span></span><br><span class="line">                <span class="keyword">if</span>(en==<span class="number">1</span>) out.writeByte(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">else</span> out.writeByte(<span class="number">0</span>);</span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                out.writeByte(<span class="number">3</span>);<span class="comment">//报头</span></span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                out.writeByte(<span class="number">11</span>);</span><br><span class="line">                <span class="keyword">if</span>(en==<span class="number">1</span>) out.writeByte(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">else</span> out.writeByte(<span class="number">0</span>);</span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                out.writeByte(<span class="number">5</span>);</span><br><span class="line">                <span class="keyword">if</span>(en==<span class="number">1</span>) out.writeByte(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">else</span> out.writeByte(<span class="number">0</span>);</span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                out.writeByte(<span class="number">6</span>);</span><br><span class="line">                <span class="keyword">if</span>(en==<span class="number">1</span>) out.writeByte(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">else</span> out.writeByte(<span class="number">0</span>);</span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                out.writeByte(<span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span>(en==<span class="number">1</span>) out.writeByte(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">else</span> out.writeByte(<span class="number">0</span>);</span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                out.writeByte(<span class="number">8</span>);</span><br><span class="line">                <span class="keyword">if</span>(en==<span class="number">1</span>) out.writeByte(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">else</span> out.writeByte(<span class="number">0</span>);</span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">                out.writeByte(<span class="number">10</span>);</span><br><span class="line">                <span class="keyword">if</span>(en==<span class="number">1</span>) out.writeByte(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">else</span> out.writeByte(<span class="number">0</span>);</span><br><span class="line">                out.writeByte(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unexpected value: &quot;</span> + flag);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义 BufferedReader输入流来读取URL的响应</span></span><br><span class="line">        in = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(</span><br><span class="line">                connection.getInputStream()));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = in.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            result += line;&#125;</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;命令下发异常！ &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用finally块来关闭输入流</span></span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="literal">null</span>) &#123;</span><br><span class="line">                in.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">            e2.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;IO close error !&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件获取"><a href="#文件获取" class="headerlink" title="文件获取"></a>文件获取</h3><p>在APP端中文件获取方法唯一的作用就是获取开箱时候的图片。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取文件(无需deviceid)</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> apiKey</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> box_id:开箱id(第几次开箱)</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> zhen:第几帧</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] getFile(String apiKey,<span class="type">int</span> box_id,<span class="type">int</span> zhen) &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">    <span class="type">byte</span> []datas=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://api.heclouds.com&quot;</span>+<span class="string">&quot;/bindata&quot;</span>+<span class="string">&quot;/&quot;</span>+index_front+box_id+<span class="string">&quot;-&quot;</span>+zhen+<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">realUrl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        <span class="comment">//打开和URL之间的连接</span></span><br><span class="line">        HttpURLConnection connection=(HttpURLConnection)realUrl.openConnection();</span><br><span class="line">        <span class="comment">//设置通用的请求属性</span></span><br><span class="line">        connection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">        connection.setRequestProperty(<span class="string">&quot;Authorization&quot;</span>,apiKey);</span><br><span class="line">        <span class="comment">//建立实际的连接</span></span><br><span class="line">        connection.connect();</span><br><span class="line">        <span class="comment">//定义 BufferedReader输入流来读取URL的响应</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> connection.getInputStream();</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="comment">// 操作（分段读取）</span></span><br><span class="line">        <span class="type">byte</span>[] flush = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];<span class="comment">// 缓冲容器</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> -<span class="number">1</span>;<span class="comment">// 接收长度</span></span><br><span class="line">        <span class="keyword">while</span> ((len = is.read(flush)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            baos.write(flush, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        baos.flush();</span><br><span class="line">        <span class="comment">// 获取数据</span></span><br><span class="line">        datas = baos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;获取文件出现异常！ &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用finally块来关闭输入流</span></span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="literal">null</span>) &#123;</span><br><span class="line">                in.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;IO close error !&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> datas;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据更新"><a href="#数据更新" class="headerlink" title="数据更新"></a>数据更新</h2><p>以APP首页的温度、湿度、光强，以及箱子的开闭，开发板的开关情况为例，这些都是在APP端的首页进行了信息展示，对于这些信息的数据更新在Android端是不能直接在Activity里生成一个Thread来进行实时更新的，那样会闪退，所以需要对于一个页面建立Handler类，在该类里面进行数据更新。</p>
<h3 id="线程中的run-方法"><a href="#线程中的run-方法" class="headerlink" title="线程中的run()方法"></a>线程中的run()方法</h3><p>该部分的逻辑是不断地发送Message给Handler进行处理，case为0时是对于开发板的六轴的数据进行获取，在case为1~3时是对于温度、湿度和光强进行更新，在case为4时则是对于箱子的开关状态进行监控。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="comment">//一个线程内发消息不能用同一个message</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">message0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">4</span>;i++)&#123;</span><br><span class="line">            <span class="comment">//使能有效就发message，否则不发</span></span><br><span class="line">            <span class="keyword">switch</span> (i)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    message0.what = <span class="number">0</span>;</span><br><span class="line">                    handler.sendMessage(message0);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">if</span>(temperature_en.en==<span class="number">1</span>) &#123;</span><br><span class="line">                        message1.what=<span class="number">1</span>;</span><br><span class="line">                        handler.sendMessage(message1);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">if</span>(guang_en.en==<span class="number">1</span>) &#123;</span><br><span class="line">                        message2.what=<span class="number">2</span>;</span><br><span class="line">                        handler.sendMessage(message2);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    <span class="keyword">if</span>(shidu_en.en==<span class="number">1</span>) &#123;</span><br><span class="line">                        message3.what=<span class="number">3</span>;</span><br><span class="line">                        handler.sendMessage(message3);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    message4.what = <span class="number">4</span>;</span><br><span class="line">                    handler.sendMessage(message4);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unexpected value: &quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MyHandler中的处理"><a href="#MyHandler中的处理" class="headerlink" title="MyHandler中的处理"></a>MyHandler中的处理</h3><p>这里主要注意到的是case为4时对于开闭状态的更改并不是直接进行更改，因为在实际测试中发现从开发板到OneNET平台的红外检测数据会有波动，这可能是红外接收和发射的装置没有完全对准好导致的结果，这会让APP端的状态更改也发生波动，所以在APP端进行了处理，在数据稳定不变几秒之后才进行箱子开闭状态的更新，防止手机端的频繁弹窗提醒。<br>其他的部分就和上述差不多，case为0时是对于开发板的六轴的数据进行获取，在case为1~3时是对于温度、湿度和光强进行更新。<br><strong>handleMessage方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(<span class="meta">@NonNull</span> Message msg)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.handleMessage(msg);</span><br><span class="line">    <span class="comment">//更新数据，刷新UI</span></span><br><span class="line">    <span class="keyword">switch</span>(msg.what)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> api.getDevice(deviceId,apiKey);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">temponline</span> <span class="operator">=</span> judgeOnline(str);</span><br><span class="line">            <span class="comment">//考虑不稳定情况，记录不稳定开始时间</span></span><br><span class="line">            <span class="keyword">if</span> (temponline != online &amp;&amp; !unstable_online) &#123;</span><br><span class="line">                utime_online_1 = System.currentTimeMillis();</span><br><span class="line">                unstable_online = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//若不稳定，记录当前时间</span></span><br><span class="line">            <span class="keyword">if</span> (unstable_online) utime_online_2 = System.currentTimeMillis();</span><br><span class="line">            <span class="comment">//若由不稳定转向稳定</span></span><br><span class="line">            <span class="keyword">if</span> (unstable_online &amp;&amp; temponline == online) unstable_online = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">//确定改变状态</span></span><br><span class="line">            <span class="keyword">if</span> (temponline != online  &amp;&amp; unstable_online &amp;&amp; utime_online_2-utime_online_1 &gt;= <span class="number">1000</span>) &#123;</span><br><span class="line">                onlineDialog(temponline);</span><br><span class="line">                onlineNotification(temponline);</span><br><span class="line">                String tempstr1=<span class="string">&quot;设备: &lt;font color=&#x27;#FF0000&#x27;&gt;&lt;small&gt;正常&lt;/small&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line">                String tempstr2=<span class="string">&quot;设备: &lt;font color=&#x27;#FF0000&#x27;&gt;&lt;small&gt;异常&lt;/small&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (temponline == <span class="literal">true</span>) t4.setText(Html.fromHtml(tempstr1));</span><br><span class="line">                <span class="keyword">else</span> t4.setText(Html.fromHtml(tempstr2));</span><br><span class="line">                online = temponline;</span><br><span class="line">                unstable_online = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//如果箱子形状发生改变要引导用户去查看箱子摆放状态，每3秒检查一次</span></span><br><span class="line">            api.refresh_acce(deviceId,apiKey);</span><br><span class="line">            acce_x = -api.acce_x;</span><br><span class="line">            acce_y = api.acce_y;</span><br><span class="line">            acce_z = api.acce_z;</span><br><span class="line">            new_degree = (<span class="type">float</span>)(Math.atan2((<span class="type">double</span>)acce_x, (<span class="type">double</span>)acce_z) * <span class="number">180</span> / Math.PI);</span><br><span class="line">            <span class="keyword">if</span>(acce_y&gt;<span class="number">700</span> &amp;&amp; acce_y&lt;<span class="number">1200</span>) new_flag = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(acce_y&gt;<span class="number">300</span> &amp;&amp; acce_y&lt;=<span class="number">700</span>) new_flag = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(acce_y&gt;-<span class="number">1200</span> &amp;&amp; acce_y&lt;-<span class="number">800</span>) new_flag = <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(acce_y&gt;=-<span class="number">800</span> &amp;&amp; acce_y&lt;-<span class="number">400</span>) new_flag = <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">else</span> new_flag = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">//不稳定的时候更新时间，直到与上一次差3000ms</span></span><br><span class="line">            <span class="keyword">if</span>(unstable_location) &#123;</span><br><span class="line">                utime_location_2 = System.currentTimeMillis();</span><br><span class="line">                <span class="keyword">if</span>(utime_location_2 - utime_location_1 &gt;=<span class="number">3000</span>)&#123;</span><br><span class="line">                    unstable_location = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//稳定的时候与old比较</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">same</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span>(new_flag != old_flag) same = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span>(!same)&#123;</span><br><span class="line">                    <span class="type">AlertDialog</span> <span class="variable">dialog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(ma)</span><br><span class="line">                            .setTitle(<span class="string">&quot;箱子状态&quot;</span>)<span class="comment">//标题</span></span><br><span class="line">                            .setMessage(<span class="string">&quot;箱子状态发生改变，请前往查看&quot;</span>)<span class="comment">//内容</span></span><br><span class="line">                            .setIcon(R.drawable.box_2)</span><br><span class="line">                            .create();</span><br><span class="line">                    dialog.show();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//更新状态和time1</span></span><br><span class="line">                utime_location_1  = System.currentTimeMillis();</span><br><span class="line">                old_degree = new_degree;</span><br><span class="line">                old_flag = new_flag;</span><br><span class="line">                unstable_location = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            api.refresh_temperature(deviceId,apiKey);</span><br><span class="line">            t1.setText(<span class="string">&quot;温度: &quot;</span>+api.temperature_zheng+<span class="string">&quot;.&quot;</span>+api.temperature_xiao);</span><br><span class="line">            showDialog(<span class="number">1</span>,api.temperature_zheng,tem_max,tem_min);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            api.refresh_guang(deviceId,apiKey);</span><br><span class="line">            t2.setText(<span class="string">&quot;光强: &quot;</span>+api.guang_zheng+<span class="string">&quot;.&quot;</span>+api.guang_xiao);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            api.refresh_shidu(deviceId,apiKey);</span><br><span class="line">            t3.setText(<span class="string">&quot;湿度: &quot;</span>+api.shi_du_zheng+<span class="string">&quot;.&quot;</span>+api.shi_du_xiao);</span><br><span class="line">            showDialog(<span class="number">3</span>,api.shi_du_zheng,shidu_max,shidu_min);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            api.refresh_isopen(deviceId,apiKey);</span><br><span class="line">            <span class="type">int</span> <span class="variable">tempisopen</span> <span class="operator">=</span> api.is_open;</span><br><span class="line">            <span class="comment">//考虑不稳定情况，记录不稳定开始时间</span></span><br><span class="line">            <span class="keyword">if</span> (tempisopen != is_open &amp;&amp; !unstable_open) &#123;</span><br><span class="line">                utime_open_1 = System.currentTimeMillis();</span><br><span class="line">                unstable_open = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//若不稳定，记录当前时间</span></span><br><span class="line">            <span class="keyword">if</span> (unstable_open) utime_open_2 = System.currentTimeMillis();</span><br><span class="line">            <span class="comment">//若由不稳定转向稳定</span></span><br><span class="line">            <span class="keyword">if</span> (unstable_open &amp;&amp; tempisopen == is_open) &#123;</span><br><span class="line">                unstable_open = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//确定改变状态</span></span><br><span class="line">            <span class="keyword">if</span> (tempisopen != is_open &amp;&amp; unstable_open &amp;&amp; utime_open_2-utime_open_1 &gt;= <span class="number">1000</span>) &#123;</span><br><span class="line">                openDialog(tempisopen);</span><br><span class="line">                openNotification(tempisopen);</span><br><span class="line">                String tempstr1=<span class="string">&quot;箱子: &lt;font color=&#x27;#FF0000&#x27;&gt;&lt;small&gt;打开&lt;/small&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line">                String tempstr2=<span class="string">&quot;箱子: &lt;font color=&#x27;#FF0000&#x27;&gt;&lt;small&gt;关闭&lt;/small&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (tempisopen == <span class="number">1</span>) t5.setText(Html.fromHtml(tempstr1));</span><br><span class="line">                <span class="keyword">else</span> t5.setText(Html.fromHtml(tempstr2));</span><br><span class="line">                is_open = tempisopen;</span><br><span class="line">                unstable_open = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unexpected value: &quot;</span> + msg.what);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//若关闭检测则不显示数据</span></span><br><span class="line">    <span class="keyword">if</span> (temperature_en.en == <span class="number">0</span>) t1.setText(<span class="string">&quot;温度:&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (guang_en.en == <span class="number">0</span>) t2.setText(<span class="string">&quot;光强:&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (shidu_en.en == <span class="number">0</span>) t3.setText(<span class="string">&quot;湿度:&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="开箱视频"><a href="#开箱视频" class="headerlink" title="开箱视频"></a>开箱视频</h2><p>开箱时树莓派的摄像头会对开箱者拍下一定数量的照片，而这些照片会上传到OneNET云平台之后，由手机端的文件读取方法读取到APP端进行展示，展示的方法就是每隔几毫秒用drawImage方法来展示图片以达到开箱“视频”的效果。</p>
<h3 id="线程中的run-方法-1"><a href="#线程中的run-方法-1" class="headerlink" title="线程中的run()方法"></a>线程中的run()方法</h3><p>这里就比较简单了，因为只涉及到一个操作也就是从OneNET平台读数据，所以只要每隔25秒就发送一次Message就可以了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//这个message必须每次new一次，不能发同一个message，会冲突</span></span><br><span class="line">            <span class="comment">//每1秒更新一次开箱总id,并以message形式发送给handler</span></span><br><span class="line">            <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">            message.what = <span class="number">5</span>;</span><br><span class="line">            myHandler_camera.sendMessage(message);</span><br><span class="line">            Thread.sleep(<span class="number">25</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MyHandler-camera中的处理方法"><a href="#MyHandler-camera中的处理方法" class="headerlink" title="MyHandler_camera中的处理方法"></a>MyHandler_camera中的处理方法</h3><p>这里同样简单，因为对于照片的处理是在MyView_camera中进行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(<span class="meta">@NonNull</span> Message msg)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.handleMessage(msg);</span><br><span class="line">    <span class="comment">//实时更新</span></span><br><span class="line">    <span class="comment">//如果开箱id发生了更新那么需要重新绘制</span></span><br><span class="line">    <span class="keyword">if</span> (msg.what == <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="comment">//刷新view展示新的照片</span></span><br><span class="line">        <span class="keyword">if</span>(box_id.state == <span class="number">0</span>)</span><br><span class="line">            myView_camera.invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MyView-camera中的处理"><a href="#MyView-camera中的处理" class="headerlink" title="MyView_camera中的处理"></a>MyView_camera中的处理</h3><p><strong>首先是onDraw()方法：</strong><br>可以看到里面用到了getFile方法来从OneNET云平台获取图片，而获取到的文件事实上是以byte数组形式来让手机端APP接收的，所以需要用一个方法byte2image方法来转换成Bitmap类型（这个类型和电脑java里的BufferedImage很像）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDraw</span><span class="params">(Canvas canvas)</span> &#123;</span><br><span class="line">    <span class="comment">//照片的字节数组</span></span><br><span class="line">    <span class="type">Bitmap</span> <span class="variable">image</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//画笔</span></span><br><span class="line">    <span class="type">Paint</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paint</span>();</span><br><span class="line">    <span class="comment">//byte数组转换为bitmap</span></span><br><span class="line">    image = byte2image(api_edp.getFile(Device.apiKey_Camera, box_id.value, box_id.en));<span class="comment">//获取照片</span></span><br><span class="line">    <span class="comment">//最后一张3</span></span><br><span class="line">    <span class="keyword">if</span> (box_id.en &gt;= box_id.sum) &#123;</span><br><span class="line">        box_id.state = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (image == <span class="literal">null</span>) &#123;</span><br><span class="line">        box_id.en++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    imageView.setImageBitmap(image);</span><br><span class="line">    box_id.en++;<span class="comment">//下一帧</span></span><br><span class="line">    box_id.state = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>byte数组转bitmap：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//byte数组转bitmap</span></span><br><span class="line"><span class="keyword">public</span> Bitmap <span class="title function_">byte2image</span><span class="params">(<span class="type">byte</span>[] dataImage)</span> &#123;</span><br><span class="line">    BitmapFactory.<span class="type">Options</span> <span class="variable">options</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BitmapFactory</span>.Options();</span><br><span class="line">    options.inSampleSize = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (dataImage != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> BitmapFactory.decodeByteArray(dataImage,<span class="number">0</span>,dataImage.length,options);</span><br><span class="line">        <span class="keyword">return</span> bitmap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="命令下达-1"><a href="#命令下达-1" class="headerlink" title="命令下达"></a>命令下达</h2><p>命令下达在APP端有对于开发板的显示屏信息的更新、蜂鸣器控制、灯光控制等功能，下面进行部分代码的展示。</p>
<h3 id="与前端的部件相连"><a href="#与前端的部件相连" class="headerlink" title="与前端的部件相连"></a>与前端的部件相连</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//与前端部件相连</span></span><br><span class="line">eText=findViewById(R.id.edittext);</span><br><span class="line">b1 = findViewById(R.id.btn1);</span><br><span class="line">b3 = findViewById(R.id.btn3);</span><br><span class="line">s2 = findViewById(R.id.sw2);    s2.setChecked(Data.fengmingqi);</span><br><span class="line">s4 = findViewById(R.id.sw4);    s4.setChecked(Data.zhaomingdeng);</span><br><span class="line">s5 = findViewById(R.id.sw5);    s5.setChecked(Data.wendujiance);</span><br><span class="line">s6 = findViewById(R.id.sw6);    s6.setChecked(Data.shidujiance);</span><br><span class="line">s7 = findViewById(R.id.sw7);    s7.setChecked(Data.guangqiangjiance);</span><br><span class="line">s8 = findViewById(R.id.sw8);    s8.setChecked(Data.liuzhoujiance);</span><br><span class="line">s10 = findViewById(R.id.sw10);  s10.setChecked(Data.wifi_isopen);</span><br><span class="line">s11 = findViewById(R.id.sw11);  s11.setChecked(Data.lowpower_isopen);</span><br><span class="line">s9 =findViewById(R.id.sw9);     s9.setChecked(Data.lanya);</span><br></pre></td></tr></table></figure>
<h3 id="postCommand方法的调用"><a href="#postCommand方法的调用" class="headerlink" title="postCommand方法的调用"></a>postCommand方法的调用</h3><p><strong>这里以更新显示屏上的文字为例：</strong><br>首先前面eText已经和前端部件edittext进行了绑定，因此在设置界面输入了相关文字（由于开发板只能显示英文所以输入的是英文），而b1和部件btn1进行了绑定，在点击btn1时监听器调用onClick方法，调用了postCommand方法，将eText.getText.toString()传入该方法，从而完成显示屏端的信息更新。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//显示信息</span></span><br><span class="line">b1.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">        api.postCommand(deviceId,apiKey,<span class="number">30</span>,eText.getText().toString(),<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="位置更新"><a href="#位置更新" class="headerlink" title="位置更新"></a>位置更新</h2><p>位置更新部分使用了高德地图的API来完成相关功能：</p>
<h3 id="线程中的run-方法-2"><a href="#线程中的run-方法-2" class="headerlink" title="线程中的run()方法"></a>线程中的run()方法</h3><p><strong>线程部分代码依然简单：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//这个message必须每次new一次，不能发同一个message，会冲突</span></span><br><span class="line">                Message message=<span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">                message.what=<span class="number">4</span>;</span><br><span class="line">                handler.sendMessage(message);</span><br><span class="line">                Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="MyHandler-location"><a href="#MyHandler-location" class="headerlink" title="MyHandler_location"></a>MyHandler_location</h3><p>这里要注意的是，标记点的更新首先需要将之前的标记点marker进行remove操作来移除，否则会出现标记点的重复，首先调用到refresh_location方法将接收到的开发板坐标进行更新，之后将数据转换成double类型，<strong>LatLng类是记录坐标点的类</strong>，将该类用到高德地图API中AMap的<strong>addMarker方法</strong>，将刚刚的数据作为参数传入，即可更新开发板在地图上的位置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(<span class="meta">@NonNull</span> Message msg)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.handleMessage(msg);</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> msg.what;</span><br><span class="line">        <span class="comment">//实时的位置更新,删除原来的marker点显示新的maker点</span></span><br><span class="line">        <span class="keyword">if</span>(msg.what==<span class="number">4</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;i &#x27;m flag&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(marker!=<span class="literal">null</span>)</span><br><span class="line">            marker.remove();</span><br><span class="line">            <span class="comment">//正常情况</span></span><br><span class="line">            api.refresh_location(deviceId,apiKey);</span><br><span class="line">            latLng = <span class="keyword">new</span> <span class="title class_">LatLng</span>(get_location_double(api.wz,api.wx),get_location_double(api.jz,api.jx));</span><br><span class="line">            marker = amap.addMarker(<span class="keyword">new</span> <span class="title class_">MarkerOptions</span>().position(latLng).title(<span class="string">&quot;旅行箱&quot;</span>).snippet(<span class="string">&quot;旅行箱&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;经度为：&quot;</span>+get_location_double(api.jz,api.jx));</span><br><span class="line">            System.out.println(<span class="string">&quot;纬度为：&quot;</span>+get_location_double(api.wz,api.wx));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="MainActivity"><a href="#MainActivity" class="headerlink" title="MainActivity"></a>MainActivity</h3><p>这部分直接放代码，主要是这个页面的一些初始化操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    supportRequestWindowFeature(Window.FEATURE_NO_TITLE);</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">        MainActivity.setStatusBarColor(<span class="built_in">this</span>,<span class="number">0xFF6BA821</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    setContentView(R.layout.activity_main3);</span><br><span class="line">    <span class="comment">//显示地图</span></span><br><span class="line">    <span class="comment">//获取地图控件引用</span></span><br><span class="line">    mapview = (MapView) findViewById(R.id.map);</span><br><span class="line">    <span class="comment">//在activity执行onCreate时执行mMapView.onCreate(savedInstanceState)，创建地图</span></span><br><span class="line">    mapview.onCreate(savedInstanceState);</span><br><span class="line">    <span class="keyword">if</span>(aMap==<span class="literal">null</span>)</span><br><span class="line">    aMap=mapview.getMap();</span><br><span class="line">    <span class="comment">//handler类实例化</span></span><br><span class="line">    myhandler_location=<span class="keyword">new</span> <span class="title class_">Myhandler_location</span>(api,aMap);</span><br><span class="line">    <span class="comment">//线程Thread实例化</span></span><br><span class="line">    refreshThread_location=<span class="keyword">new</span> <span class="title class_">RefreshThread_location</span>(myhandler_location);</span><br><span class="line">    <span class="comment">//开启定位权限</span></span><br><span class="line">    <span class="comment">//看权限是否开启</span></span><br><span class="line">    <span class="keyword">if</span>(ContextCompat.checkSelfPermission(<span class="built_in">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED)&#123;<span class="comment">//未开启定位权限</span></span><br><span class="line">        <span class="comment">//开启定位权限,200是标识码</span></span><br><span class="line">        ActivityCompat.requestPermissions(<span class="built_in">this</span>,<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;Manifest.permission.ACCESS_FINE_LOCATION&#125;,<span class="number">200</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//开始定位</span></span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>,<span class="string">&quot;已开启定位权限&quot;</span>,Toast.LENGTH_LONG).show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//开启定位蓝点</span></span><br><span class="line">    myLocationStyle = <span class="keyword">new</span> <span class="title class_">MyLocationStyle</span>();<span class="comment">//初始化定位蓝点样式类</span></span><br><span class="line">    myLocationStyle.myLocationType(MyLocationStyle.LOCATION_TYPE_LOCATION_ROTATE);<span class="comment">//连续定位、且将视角移动到地图中心点，定位点依照设备方向旋转，并且会跟随设备移动。（1秒1次定位）如果不设置myLocationType，默认也会执行此种模式。</span></span><br><span class="line">    myLocationStyle.interval(<span class="number">2000</span>); <span class="comment">//设置连续定位模式下的定位间隔，只在连续定位模式下生效，单次定位模式下不会生效。单位为毫秒。</span></span><br><span class="line">    <span class="comment">//myLocationStyle.myLocationIcon(BitmapDescriptorFactory.fromResource(R.drawable.gps_point));</span></span><br><span class="line">    myLocationStyle.myLocationType(MyLocationStyle.LOCATION_TYPE_MAP_ROTATE);</span><br><span class="line">    aMap.setMyLocationStyle(myLocationStyle);<span class="comment">//设置定位蓝点的Style</span></span><br><span class="line">    aMap.getUiSettings().setMyLocationButtonEnabled(<span class="literal">true</span>);<span class="comment">//设置默认定位按钮是否显示，非必需设置。</span></span><br><span class="line">    aMap.setMyLocationEnabled(<span class="literal">true</span>);<span class="comment">// 设置为true表示启动显示定位蓝点，false表示隐藏定位蓝点并不进行定位，默认是false。</span></span><br><span class="line">    <span class="comment">//开启更新位置的线程</span></span><br><span class="line">    refreshThread_location.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Java/">#Java</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/04/20/Spring%E6%80%BB%E7%BB%93/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Spring总结</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/01/15/Java%E7%AC%94%E8%AE%B0/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Java笔记</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Carbda</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1"><span class="nav-text">功能设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E7%AE%B1%E6%A3%80%E6%B5%8B%E4%B8%8E%E6%99%BA%E8%83%BD%E7%9B%91%E6%B5%8B"><span class="nav-text">开箱检测与智能监测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E7%AE%B1%E6%8F%90%E9%86%92%E4%B8%8E%E5%BC%80%E7%AE%B1%E8%AE%B0%E5%BD%95"><span class="nav-text">开箱提醒与开箱记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E8%BE%83%E6%9A%97%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%89"><span class="nav-text">环境较暗自动补光</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E7%AE%B1%E8%87%AA%E5%8A%A8%E6%8B%8D%E7%85%A7%E8%AE%B0%E5%BD%95%E5%BC%80%E7%AE%B1%E4%BA%BA%E4%B8%8E%E5%8F%96%E6%94%BE%E7%89%A9%E5%93%81"><span class="nav-text">开箱自动拍照记录开箱人与取放物品</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%85%E8%A1%8C%E7%AE%B1%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B%E4%B8%8E%E5%88%86%E6%9E%90"><span class="nav-text">旅行箱状态检测与分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%A9%E6%B9%BF%E5%BA%A6%E6%A3%80%E6%B5%8B"><span class="nav-text">温湿度检测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%B1%E5%AD%90%E6%94%BE%E7%BD%AE%E5%BD%A2%E7%8A%B6%E6%A3%80%E6%B5%8B"><span class="nav-text">箱子放置形状检测</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8D%E7%BD%AE%E4%B8%8E%E5%AE%89%E5%85%A8"><span class="nav-text">位置与安全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%BD%8D%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%AF%BC%E8%88%AA"><span class="nav-text">定位服务与导航</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%B1%E5%AD%90%E8%BF%9C%E7%A6%BB%E6%8F%90%E9%86%92"><span class="nav-text">箱子远离提醒</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A3%B0%E9%9F%B3%E5%AF%BB%E7%AE%B1"><span class="nav-text">声音寻箱</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E6%98%BE%E7%A4%BA"><span class="nav-text">消息显示</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#APP%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-text">APP端实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#OnetNET%E5%B9%B3%E5%8F%B0%E4%BA%A4%E4%BA%92"><span class="nav-text">OnetNET平台交互</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%91OneNet%E6%9F%A5%E8%AF%A2%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF"><span class="nav-text">向OneNet查询设备信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E8%AE%BE%E5%A4%87%E6%95%B0%E6%8D%AE%E7%82%B9"><span class="nav-text">查找设备数据点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E4%B8%8B%E8%BE%BE"><span class="nav-text">命令下达</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E8%8E%B7%E5%8F%96"><span class="nav-text">文件获取</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0"><span class="nav-text">数据更新</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84run-%E6%96%B9%E6%B3%95"><span class="nav-text">线程中的run()方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MyHandler%E4%B8%AD%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-text">MyHandler中的处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E7%AE%B1%E8%A7%86%E9%A2%91"><span class="nav-text">开箱视频</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84run-%E6%96%B9%E6%B3%95-1"><span class="nav-text">线程中的run()方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MyHandler-camera%E4%B8%AD%E7%9A%84%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95"><span class="nav-text">MyHandler_camera中的处理方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MyView-camera%E4%B8%AD%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-text">MyView_camera中的处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E4%B8%8B%E8%BE%BE-1"><span class="nav-text">命令下达</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8E%E5%89%8D%E7%AB%AF%E7%9A%84%E9%83%A8%E4%BB%B6%E7%9B%B8%E8%BF%9E"><span class="nav-text">与前端的部件相连</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#postCommand%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8"><span class="nav-text">postCommand方法的调用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8D%E7%BD%AE%E6%9B%B4%E6%96%B0"><span class="nav-text">位置更新</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84run-%E6%96%B9%E6%B3%95-2"><span class="nav-text">线程中的run()方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MyHandler-location"><span class="nav-text">MyHandler_location</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MainActivity"><span class="nav-text">MainActivity</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>




    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>




<div class="post-scripts">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>



</body>
</html>
